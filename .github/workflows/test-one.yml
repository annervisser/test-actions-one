name: test run one
on: push
jobs:
  actual-job:
    runs-on: ubuntu-latest
    steps:
      - name: fail
        run: sleep 3
  final-job:
    runs-on: ubuntu-latest
    needs: [actual-job]
    steps:
      - run: echo "final"
  report-job:
    runs-on: ubuntu-latest
    needs: [final-job]
    if: always()
    steps:
      - name: slack
        run: |
           STATUSES="${{join(needs.*.result,'')}}" # Combines all results in one long string
           echo "statuses: $STATUSES"
           FILTERED="${STATUSES//success/}" # Removes all success statuses
           echo "filtered: $FILTERED"
           STATUS=$([[ -z "$FILTERED" ]] && echo "success" || echo "failure") # if not empty, its a failure
           echo "status: $STATUS"
           echo "${{toJSON(needs)}}"
#          echo "slack ${{job.status}}"
#          echo "${{needs.actual-job.result == 'success' && 'succ' || 'fail'}}"
#          echo "gas ${{github.action_status}}"
