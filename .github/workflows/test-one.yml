name: test run one
on: push
jobs:
  actual-job:
    runs-on: ubuntu-latest
    steps:
      - name: fail
        run: exit 1
  final-job:
    runs-on: ubuntu-latest
    if: always()
    needs: [actual-job]
    steps:
      - name: cancel if failure
        if: ${{ job.status != 'success' }}
        run: exit 1
      - name: actual step
        run: echo "final job work"
      - name: slack
        if: always()
        run: echo "slack ${{job.status}}"
  report-job:
    runs-on: ubuntu-latest
    needs: [actual-job, final-job]
    if: always()
    steps:
      - name: failure?
        if: failure()
        run: echo "failure"
      - name: slack
        run: |
           STATUSES="${{join(needs.*.result,'')}}" # Combines all results in one long string
           echo "statuses: $STATUSES"
           FILTERED="${STATUSES//success/}" # Removes all success statuses
           echo "filtered: $FILTERED"
           STATUS=$([[ -z "$FILTERED" ]] && echo "success" || echo "failure") # if not empty, its a failure
           echo "status: $STATUS"
           echo "${{toJSON(needs)}}"
#          echo "slack ${{job.status}}"
#          echo "${{needs.actual-job.result == 'success' && 'succ' || 'fail'}}"
#          echo "gas ${{github.action_status}}"
